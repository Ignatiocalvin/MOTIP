# Optimized P-DESTRE config for faster training
# This config reduces training time from ~80 hours to ~24 hours per epoch
# by using larger sample intervals and enabling intra-epoch checkpointing

SUPER_CONFIG_PATH: ./configs/r50_deformable_detr_motip_dancetrack.yaml

# --- Override Data Settings ---
DATASETS: [P-DESTRE]
squDATASET_SPLITS: [Train_3]
INFERENCE_DATASET: P-DESTRE
INFERENCE_SPLIT: val_3

# --- CRITICAL: Sample settings to reduce iterations ---
# Original: SAMPLE_INTERVALS: [4] -> ~97,000 iterations
# Optimized: SAMPLE_INTERVALS: [15] -> ~26,000 iterations (3.7x faster)
SAMPLE_STEPS: [0, ]
SAMPLE_LENGTHS: [15, ]
SAMPLE_INTERVALS: [4, ]  # Increased from 4 to 15 - this is the key speedup!

# --- Model & Loss Settings (MOTIP with Multiple Concepts) ---
MOTIP:
  N_CONCEPTS: 2  # Number of concept types (gender, upper_body_clothing)
  # CONCEPT_CLASSES: list of [name, num_classes, unknown_label_index]
  # - Gender: 0=Male, 1=Female, 2=Unknown
  # - Upper Body Clothing: 0=T-Shirt, 1=Blouse, 2=Sweater, 3=Coat, 4=Bikini, 
  #                        5=Naked, 6=Dress, 7=Uniform, 8=Shirt, 9=Suit, 
  #                        10=Hoodie, 11=Cardigan, 12=Unknown
  CONCEPT_CLASSES:
    - ["gender", 3, 2]           # name, num_classes, unknown_label
    - ["upper_body", 13, 12]     # name, num_classes, unknown_label
  DETR_LOSSES: [labels, boxes, cardinality, concepts]
  CONCEPT_LOSS_COEF: 0.5

# --- Training optimizations ---
EPOCHS: 3
NUM_WORKERS: 5              # Increased from 2 for better data loading
PREFETCH_FACTOR: 4          # Increased prefetch

# --- Intra-epoch checkpointing (CRITICAL for long jobs) ---
# Saves checkpoint every 5000 steps (~5 hours of work)
# Allows resuming if job times out at 72 hours
SAVE_CHECKPOINT_EVERY_N_STEPS: 5000
RESUME_FROM_STEP: 0         # Set this to resume from a mid-epoch checkpoint

# --- Outputs ---
EXP_NAME: r50_deformable_detr_motip_pdestre_fast
SAVE_CHECKPOINT_PER_EPOCH: 1
MULTI_LAST_CHECKPOINTS: 4   # Save 4 checkpoints during last epoch
